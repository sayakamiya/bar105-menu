<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bar105 â€” ã‚ªãƒ¼ãƒ€ãƒ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
<style>
  :root{
    --gold:#c9a227;
    --muted:#d9cfc6;
    --bg-wood-1:#1b1410;
    --bg-wood-2:#3a2b24;
    --card-wood:#2a201b;
    --accent-dark:#201814;
    --gap:12px;
    --btn-size:40px;
  }
  * {box-sizing:border-box;}
  body{
    margin:0; padding:20px;
    font-family:"Noto Sans JP",sans-serif;
    background:linear-gradient(180deg,var(--bg-wood-1),var(--bg-wood-2));
    color:var(--muted);
  }
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;}
  h1{margin:0; color:var(--gold); font-size:20px;}
  .top-controls{display:flex; gap:8px; align-items:center;}
  .btn {background:#3a2b24; color:var(--muted); border:1px solid #4d3d2d; border-radius:6px; padding:8px 10px; cursor:pointer;}
  .btn:hover{background:#4a3a2e; color:var(--gold);}
  .small {padding:6px 8px; font-size:13px;}
  .menu-area {display:grid; grid-template-columns:1fr 1fr; gap:20px;}
  @media(max-width:900px){ .menu-area{grid-template-columns:1fr;} }

  .menu-group {background:var(--card-wood); padding:12px; border-radius:10px;}
  .menu-group h2{margin:0 0 10px 0; font-size:16px; color:var(--gold); display:flex; align-items:center; gap:8px;}
  .menu-item {
    background:var(--accent-dark);
    border:1px solid #3c2f27;
    border-radius:8px;
    padding:10px;
    margin-bottom:12px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .menu-item .title {display:flex; justify-content:space-between; align-items:center; gap:8px;}
  .menu-item .title .name{font-weight:700;}
  .price{min-width:80px; text-align:right;}

  .btn-row {display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  .qty-btn {
    width:var(--btn-size); height:var(--btn-size);
    display:inline-grid; place-items:center;
    border-radius:8px;
    background:#3a2b24; color:var(--muted);
    border:1px solid #4d3d2d; cursor:pointer; font-weight:700;
  }
  .qty-btn:hover{background:#4a3a2e; color:var(--gold);}
  .qty {display:inline-block; min-width:48px; text-align:center; font-weight:700; font-size:16px;}

  .summary {
    margin-top:20px;
    background:var(--card-wood);
    border-radius:10px;
    padding:15px;
  }
  .order-line{display:flex; justify-content:space-between; margin-bottom:6px;}
  .total{font-size:20px; text-align:right; color:#fff; margin-top:8px;}

  .control{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;}
  .control .btn{flex:1}

  .editable {background:rgba(255,255,255,0.03); padding:6px; border-radius:6px;}
  .input-inline {background:transparent; border:1px dashed rgba(255,255,255,0.06); color:var(--muted); padding:4px 6px; border-radius:4px; min-width:60px;}

  .del-btn{
    margin-left:8px;
    background:#5b1e1e; color:#ffd8d8; border:1px solid #7b2e2e;
    border-radius:6px; padding:4px 8px; cursor:pointer; font-size:12px;
  }

  body.modern {
    background:linear-gradient(180deg,#0f1112,#151619);
    color:#eee;
  }
  body.modern .menu-group {background:#141416;}
  body.modern .menu-item {background:#0e0f10; border-color:#252627;}
  body.modern .btn {background:#1a1b1c; border-color:#333;}
  body.modern .btn:hover{color:#fff;}
  body.modern h1{color:#ffffff;}
  body.modern .menu-group h2{color:#ffffff;}
  body.modern .qty-btn{background:#1b1c1d; border-color:#333;}

  .footer {margin-top:14px; font-size:13px; color:#cfc7bd;}
  .row {display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  select, input[type="number"], input[type="text"]{padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--muted);}
  .danger {background:#5b1e1e; color:#ffd8d8;}
</style>
</head>
<body>
<header>
  <h1>ğŸ¸ Bar105 ã‚ªãƒ¼ãƒ€ãƒ¼è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>
  <div class="top-controls">
    <button class="btn small" id="toggle-edit">ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: OFF</button>
    <button class="btn small" id="theme-switch">ğŸ¨ ãƒ†ãƒ¼ãƒåˆ‡æ›¿</button>
    <button class="btn small" id="add-item-btn">ï¼‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ </button>
    <button class="btn small" id="reset-default">åˆæœŸåŒ–</button>
  </div>
</header>

<div class="menu-area">
  <div class="menu-group" data-group="food">
    <h2>ğŸ½ é£Ÿã¹ç‰©</h2>
    <div id="group-food"></div>
  </div>

  <div class="menu-group" data-group="drink">
    <h2>ğŸ¹ é£²ã¿ç‰©</h2>
    <div id="group-drink"></div>
  </div>
</div>

<div class="summary">
  <h2>ğŸ§¾ æ³¨æ–‡å†…å®¹</h2>
  <div id="order-list"></div>
  <div class="total" id="total-price">Â¥0</div>
  <div class="control">
    <button class="btn" id="copy-order">å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼</button>
    <button class="btn" id="copy-total">é‡‘é¡ã‚’ã‚³ãƒ”ãƒ¼</button>
    <button class="btn" id="reset-order">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div class="footer">
    â€» ç·¨é›†å†…å®¹ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆlocalStorageï¼‰ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã™ã‚Œã°ã‚¹ã‚¿ãƒƒãƒ•å…¨å“¡ãŒåŒã˜HTMLã§ä½¿ãˆã¾ã™ã€‚
  </div>
</div>

<!-- è¿½åŠ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ -->
<div id="add-dialog" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:50;">
  <div style="background:rgba(30,24,20,0.98); padding:18px; border-radius:10px; width:320px; color:var(--muted);">
    <h3 style="margin-top:0; color:var(--gold)">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ </h3>
    <div style="display:flex; flex-direction:column; gap:8px;">
      <label>ã‚°ãƒ«ãƒ¼ãƒ—
        <select id="new-group"><option value="food">ğŸ½ é£Ÿã¹ç‰©</option><option value="drink">ğŸ¹ é£²ã¿ç‰©</option></select>
      </label>
      <label>åå‰ <input id="new-name" type="text" placeholder="ä¾‹: ãƒ•ãƒ©ã‚¤ãƒ‰ãƒãƒ†ãƒˆ"></label>
      <label>ä¾¡æ ¼ï¼ˆå††ï¼‰ <input id="new-price" type="number" min="0" value="1000"></label>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
        <button class="btn" id="add-confirm">è¿½åŠ </button>
        <button class="btn" id="add-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>
</div>

<script>
/*
  V3 å®Œå…¨ç‰ˆ
  - copyOrder ã®æ”¹è¡Œãƒã‚°ä¿®æ­£ï¼ˆå®Ÿéš›ã®æ”¹è¡Œã‚’ clipboard ã«æ¸¡ã™ï¼‰
  - ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã®å¤‰æ›´ã‚’å³ä¿å­˜ï¼ˆOFFã«ã—ã¦ã‚‚ä¿æŒï¼‰
  - ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§å‰Šé™¤ãƒœã‚¿ãƒ³è¡¨ç¤ºãƒ»å‰Šé™¤å¯èƒ½
  - 8ãƒœã‚¿ãƒ³æ§‹æˆã‚’å¾©æ´» (+1 +5 +10 +50 / -1 -5 -10 -50)
  - localStorage: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯å„ãƒ–ãƒ©ã‚¦ã‚¶ã«æ°¸ç¶šä¿å­˜
*/

const STORAGE_KEY = "bar105_menus_v3";
const THEME_KEY = "bar105_theme_v3";
const DEFAULT_MENUS = [
  {id:"nuts", group:"food", name:"ãƒŸãƒƒã‚¯ã‚¹ãƒŠãƒƒãƒ„ï¼ˆè…¹20%ï¼‰", price:3000},
  {id:"caprese", group:"food", name:"ã‚«ãƒ—ãƒ¬ãƒ¼ã‚¼ï¼ˆè…¹35%ï¼‰", price:4500},
  {id:"ajillo", group:"food", name:"ã‚¢ãƒ’ãƒ¼ã‚¸ãƒ§ï¼ˆè…¹50%ï¼‰", price:9000},
  {id:"gintonic", group:"drink", name:"ã‚¸ãƒ³ãƒˆãƒ‹ãƒƒã‚¯ï¼ˆæ°´åˆ†35%ï¼‰", price:4500},
  {id:"mojito", group:"drink", name:"ãƒ¢ãƒ’ãƒ¼ãƒˆï¼ˆæ°´åˆ†40%ï¼‰", price:6000},
  {id:"tequila", group:"drink", name:"ãƒ†ã‚­ãƒ¼ãƒ©ã‚µãƒ³ãƒ©ã‚¤ã‚ºï¼ˆæ°´åˆ†50%ï¼‰", price:12000}
];

let menus = loadMenus();
let order = {};
let editMode = false;

function loadMenus(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) return JSON.parse(raw);
  }catch(e){}
  localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_MENUS));
  return JSON.parse(JSON.stringify(DEFAULT_MENUS));
}
function saveMenus(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(menus)); }

function applyTheme(){
  const t = localStorage.getItem(THEME_KEY) || "classic";
  document.body.classList.toggle("modern", t==="modern");
  document.getElementById("theme-switch").textContent = t==="modern" ? "ğŸ¨ Modern" : "ğŸ¨ Bar Classic";
}
function toggleTheme(){
  const cur = localStorage.getItem(THEME_KEY) || "classic";
  localStorage.setItem(THEME_KEY, cur==="classic" ? "modern" : "classic");
  applyTheme();
}

function formatYen(n){ return "Â¥"+n.toLocaleString(); }

function renderMenus(){
  const foodEl = document.getElementById("group-food");
  const drinkEl = document.getElementById("group-drink");
  foodEl.innerHTML = "";
  drinkEl.innerHTML = "";

  for(const it of menus){
    const container = document.createElement("div");
    container.className = "menu-item";
    container.dataset.id = it.id;
    container.dataset.group = it.group;
    container.dataset.price = it.price;
    container.dataset.name = it.name;

    // Build HTML with full 8-button layout
    container.innerHTML = `
      <div class="title">
        <span class="name" ${editMode ? 'contenteditable="true"' : ''}>${escapeHtml(it.name)}</span>
        <span class="price" ${editMode ? 'contenteditable="true"' : ''}>${formatYen(it.price)}</span>
        ${editMode ? '<button class="del-btn">å‰Šé™¤</button>' : ''}
      </div>
      <div class="btn-row">
        <button class="qty-btn" data-change="1">+1</button>
        <button class="qty-btn" data-change="5">+5</button>
        <button class="qty-btn" data-change="10">+10</button>
        <button class="qty-btn" data-change="50">+50</button>
        <span class="qty" id="qty-${it.id}">0</span>
        <button class="qty-btn" data-change="-1">-1</button>
        <button class="qty-btn" data-change="-5">-5</button>
        <button class="qty-btn" data-change="-10">-10</button>
        <button class="qty-btn" data-change="-50">-50</button>
      </div>
    `;

    // Attach button handlers
    container.querySelectorAll('.qty-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> updateOrder(btn, parseInt(btn.dataset.change)));
    });

    // If editable, attach events to name/price and delete
    if(editMode){
      const nameEl = container.querySelector('.name');
      const priceEl = container.querySelector('.price');

      nameEl.addEventListener('input', ()=> {
        // live update dataset to reflect edits immediately
        container.dataset.name = nameEl.textContent.trim();
      });
      // on blur, commit to menus and save
      nameEl.addEventListener('blur', ()=> {
        const newName = nameEl.textContent.trim();
        updateMenuField(it.id, {name: newName});
      });

      priceEl.addEventListener('input', ()=> {
        // allow typing; visual only
      });
      priceEl.addEventListener('blur', ()=> {
        // parse digits from priceEl
        const digits = (priceEl.textContent || "").replace(/[^\d]/g,'');
        const newPrice = digits === "" ? 0 : parseInt(digits,10);
        priceEl.textContent = formatYen(newPrice);
        updateMenuField(it.id, {price: newPrice});
      });

      const delBtn = container.querySelector('.del-btn');
      if(delBtn){
        delBtn.addEventListener('click', ()=>{
          if(confirm(`ã€Œ${it.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)){
            menus = menus.filter(m => m.id !== it.id);
            saveMenus();
            renderMenus();
          }
        });
      }
    }

    // Append to correct group
    if(it.group === "food") foodEl.appendChild(container);
    else drinkEl.appendChild(container);
  }
}

// Utility to escape HTML when inserting textContent-like strings into innerHTML
function escapeHtml(s){
  if(!s) return "";
  return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

// Update menu field (by id), save and re-render minimal
function updateMenuField(id, fields){
  let changed = false;
  menus = menus.map(m=>{
    if(m.id === id){
      changed = true;
      return {...m, ...fields};
    }
    return m;
  });
  if(changed) {
    saveMenus();
    // re-render but preserve qtys and editMode state
    renderMenus();
  }
}

function updateOrder(btn, change){
  const item = btn.closest(".menu-item");
  const id = item.dataset.id;
  // name/price taken from menus array to ensure latest saved values
  const menu = menus.find(m=>m.id === id) || {name:item.dataset.name, price:parseInt(item.dataset.price)||0};
  const name = menu.name;
  const price = parseInt(menu.price) || 0;
  const qtyEl = document.getElementById("qty-"+id);
  let qty = parseInt(qtyEl.textContent || "0",10) + change;
  if(qty < 0) qty = 0;
  qtyEl.textContent = qty;
  if(qty > 0) order[id] = {name, price, qty};
  else delete order[id];
  refresh();
}

function refresh(){
  const list = document.getElementById("order-list");
  list.innerHTML = "";
  let total = 0;
  for(const [id,it] of Object.entries(order)){
    const div = document.createElement("div");
    div.className = "order-line";
    div.innerHTML = `<span>${escapeHtml(it.name)} Ã— ${it.qty}</span><span>Â¥${(it.price*it.qty).toLocaleString()}</span>`;
    list.appendChild(div);
    total += it.price * it.qty;
  }
  document.getElementById("total-price").textContent = "Â¥" + total.toLocaleString();
}

// Copy order: ensure actual line breaks are sent to clipboard
function copyOrder(){
  const lines = Object.values(order).map(o => `${o.name}Ã—${o.qty}`);
  const txt = lines.length ? lines.join("\n") : "æ³¨æ–‡ãªã—";
  // use navigator.clipboard if available
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(txt).then(()=> alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
  } else {
    // fallback
    const ta = document.createElement("textarea");
    ta.value = txt;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand("copy"); alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); } catch(e) { alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"); }
    ta.remove();
  }
}

// Copy total (string)
function copyTotal(){
  const total = document.getElementById("total-price").textContent;
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(total).then(()=> alert("åˆè¨ˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
  } else {
    const ta = document.createElement("textarea");
    ta.value = total;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand("copy"); alert("åˆè¨ˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); } catch(e) { alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"); }
    ta.remove();
  }
}

function resetOrder(){
  if(!confirm("ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
  order = {};
  document.querySelectorAll(".qty").forEach(e => e.textContent = "0");
  refresh();
}

function toggleEdit(){
  editMode = !editMode;
  document.getElementById("toggle-edit").textContent = "ç·¨é›†ãƒ¢ãƒ¼ãƒ‰: " + (editMode ? "ON" : "OFF");
  // When entering edit mode, make contenteditable and show delete buttons.
  // When leaving edit mode, the current menu edits are already saved on blur; just re-render.
  renderMenus();
}

function showAddDialog(){
  document.getElementById("add-dialog").style.display = "flex";
}
function hideAddDialog(){
  document.getElementById("add-dialog").style.display = "none";
}

document.getElementById("add-confirm").onclick = function(){
  const group = document.getElementById("new-group").value;
  const name = (document.getElementById("new-name").value || "").trim();
  const priceVal = document.getElementById("new-price").value;
  const price = priceVal === "" ? 0 : parseInt(priceVal,10);
  if(!name){ alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  if(isNaN(price)){ alert("ä¾¡æ ¼ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  const id = "id" + Date.now();
  menus.push({id, group, name, price});
  saveMenus();
  hideAddDialog();
  renderMenus();
};

document.getElementById("add-cancel").onclick = hideAddDialog;
document.getElementById("add-item-btn").onclick = showAddDialog;
document.getElementById("toggle-edit").onclick = toggleEdit;
document.getElementById("reset-order").onclick = resetOrder;
document.getElementById("copy-order").onclick = copyOrder;
document.getElementById("copy-total").onclick = copyTotal;
document.getElementById("theme-switch").onclick = toggleTheme;

document.getElementById("reset-default").onclick = function(){
  if(confirm("å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿï¼ˆç¾åœ¨ã®ä¿å­˜ã¯æ¶ˆãˆã¾ã™ï¼‰")){
    localStorage.removeItem(STORAGE_KEY);
    menus = loadMenus();
    renderMenus();
  }
};

// Initial render
applyTheme();
renderMenus();
refresh();
</script>
</body>
</html>
